syntax = "proto3";

package common.gossip.rpc;

import "google/protobuf/empty.proto";

option cc_generic_services = true;

enum State {
  ALIVE = 0;
  SUSPECT = 1;
  DEAD = 2;
  LEFT = 3;
}

message Node {
  string name = 1;
  string ip = 2;
  uint32 port = 3;
  State state = 4;
  bytes metadata = 5;
}

message PingReq {
  uint32 version = 1;
  string name = 2;
}

message IndirectPingReq {
  PingReq ping = 1;
  string ip = 2;
  uint32 port = 3;
}

message PingResp {
  uint32 version = 1;
  enum Type {
    ACK = 0;
    NACK = 1;
  }
  Type type = 2;
}

message AliveMsg {
  uint32 version = 1;
  string name = 2;
  string ip = 3;
  uint32 port = 4;
  bytes metadata = 5;
}

message SuspectMsg {
  uint32 version = 1;
  string name = 2;
  repeated string from = 3;
}

message DeadMsg {
  uint32 version = 1;
  string name = 2;
  repeated string from = 3;
}

message SyncMsg {
  uint32 version = 1;
  repeated Node nodes = 2;
}

service GossipServerAPI {
  rpc Ping(PingReq) returns (PingResp) {}
  rpc IndirectPing(IndirectPingReq) returns (PingResp) {}
  rpc Sync(SyncMsg) returns (SyncMsg) {}
  rpc Suspect(SuspectMsg) returns (google.protobuf.Empty) {}
  rpc Dead(DeadMsg) returns (google.protobuf.Empty) {}
}
